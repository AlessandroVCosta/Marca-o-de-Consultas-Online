<div class="user-appointment-container">
  <h2>Nova Marcação</h2>
  <form (ngSubmit)="submitRequest()" #form="ngForm">
    <div class="form-group">
      <label>Nome Completo</label>
      <input type="text" name="fullName" [(ngModel)]="fullName" disabled class="form-control" />
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" name="email" [(ngModel)]="email" disabled class="form-control" />
    </div>
    <div *ngFor="let acto of actos; let i = index" class="acto-bloco">
      <h5>Acto Clínico {{ i + 1 }}</h5>
      <div class="form-group">
        <label>Tipo de Consulta/Exame</label>
        <select name="actTypeId{{i}}" [(ngModel)]="acto.actTypeId" required class="form-control">
          <option value="">Selecione</option>
          <option *ngFor="let t of actTypes" [value]="t.id">{{ t.nome }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Sub-sistema de Saúde</label>
        <select name="subsystem{{i}}" [(ngModel)]="acto.subsystem" required class="form-control">
          <option *ngFor="let s of healthSubsystems" [value]="s.value">{{ s.label }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Profissional (opcional)</label>
        <select name="professionalId{{i}}" [(ngModel)]="acto.professionalId" class="form-control">
          <option value="">Selecione</option>
          <option *ngFor="let p of professionals" [value]="p.id">{{ p.nome }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>Data Início Solicitado</label>
        <input type="date" name="dataInicioSolicitado{{i}}" [(ngModel)]="acto.dataInicioSolicitado" required class="form-control" />
      </div>
      <div class="form-group">
        <label>Data Fim Solicitado</label>
        <input type="date" name="dataFimSolicitado{{i}}" [(ngModel)]="acto.dataFimSolicitado" required class="form-control" />
      </div>
      <div class="form-group">
        <label>Horário Solicitado (opcional)</label>
        <input type="time" name="horaSolicitada{{i}}" [(ngModel)]="acto.horaSolicitada" class="form-control" />
      </div>
      <div class="form-group">
        <label>Observações (opcional)</label>
        <textarea name="observacoes{{i}}" [(ngModel)]="acto.observacoes" class="form-control"></textarea>
      </div>
      <button type="button" class="btn btn-danger" (click)="removeActo(i)" *ngIf="actos.length > 1">Remover Acto</button>
      <hr *ngIf="i < actos.length - 1" />
    </div>
    <button type="button" class="btn btn-secondary" (click)="addActo()">Adicionar Acto</button>
    <button type="submit" class="btn btn-success mt-3" [disabled]="loading">Enviar Pedido de Marcação</button>
    <div *ngIf="success" class="alert alert-success mt-2">Pedido enviado com sucesso!</div>
    <div *ngIf="error" class="alert alert-danger mt-2">{{ error }}</div>
  </form>
</div>

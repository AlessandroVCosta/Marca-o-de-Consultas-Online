<div class="profile-container">
  <h2>Meu Perfil</h2>
  <form (ngSubmit)="saveProfile()" #form="ngForm">
    <div class="form-group">
      <label>Nome Completo</label>
      <input type="text" [(ngModel)]="user.fullName" name="fullName" required class="form-control" />
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" [(ngModel)]="user.email" name="email" class="form-control" disabled />
    </div>
    <div class="form-group">
      <label>Data de Nascimento</label>
      <input type="date" [(ngModel)]="user.dataNascimento" name="dataNascimento" class="form-control" />
    </div>
    <div class="form-group">
      <label>Género</label>
      <select [(ngModel)]="user.genero" name="genero" class="form-control">
        <option value="">Selecione</option>
        <option value="0">Masculino</option>
        <option value="1">Feminino</option>
        <option value="2">Outro</option>
      </select>
    </div>
    <div class="form-group">
      <label>Telefone</label>
      <input type="tel" [(ngModel)]="user.telefone" name="telefone" class="form-control" />
    </div>
    <div class="form-group">
      <label>Morada</label>
      <input type="text" [(ngModel)]="user.morada" name="morada" class="form-control" />
    </div>
    <div class="form-group">
      <label>Fotografia (URL)</label>
      <input type="url" [(ngModel)]="user.fotografiaUrl" name="fotografiaUrl" class="form-control" />
    </div>
    <div class="form-group">
      <label>Número Utente de Saúde</label>
      <input type="text" [(ngModel)]="user.numeroUtenteSaude" name="numeroUtenteSaude" class="form-control" />
    </div>
    <div class="form-group">
      <label>Nova Senha</label>
      <input type="password" [(ngModel)]="user.password" name="password" class="form-control" />
    </div>
    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
    <div *ngIf="feedback" class="alert alert-success mt-2">{{ feedback }}</div>
    <div *ngIf="feedbackErro" class="alert alert-danger mt-2">{{ feedbackErro }}</div>
  </form>

  <hr />
  <h3>Histórico de Pedidos</h3>
  <div *ngIf="loadingPedidos" class="alert alert-info">Carregando histórico...</div>
  <div *ngIf="errorPedidos" class="alert alert-danger">{{ errorPedidos }}</div>
  <div *ngIf="!loadingPedidos && pedidos.length === 0" class="alert alert-warning">Nenhum pedido encontrado.</div>
  <div *ngIf="pedidos.length > 0">
    <table class="table table-bordered table-striped mt-3">
      <thead>
        <tr>
          <th>Data do Pedido</th>
          <th>Status</th>
          <th>Actos Clínicos</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pedido of pedidos">
          <td>{{ pedido.dataPedido | date:'short' }}</td>
          <td>{{ pedido.status }}</td>
          <td>
            <ul>
              <li *ngFor="let item of pedido.items">
                {{ item.actTypeNome }} - {{ item.dataInicioSolicitado }} a {{ item.dataFimSolicitado }}
              </li>
            </ul>
          </td>
          <td>
            <button class="btn btn-outline-secondary btn-sm" (click)="exportarPdf(pedido.id)">Exportar PDF</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
